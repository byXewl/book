Linux几种权限维持的方式，很多手法都是能够被发现的，或者很明显的，比如文件的落地时间，通常在运维人员在看见新文件的时候，都会去看看，文件里面写的是什么，是谁建立的，如果运维人员就一个，那么肯定被查的概率更高。

所以需要适当的隐藏自己留的后门，大部分需要已经有root权限。




## **文件时间伪造**
提前创建了一个1.txt的文件，我们查看一下1.txt的时间，可以明显发现格格不入，如果是运维人员看见，那么一定会去排查这个问题，那么如果这个是木马文件，那么就直接被发现了。

将文件时间修改一下和另一文件的时间一样：、
```
touch -r 目标时间戳的文件 要修改时间戳的文件 
```



## **使用隐藏文件**
在Linux系统文件前面添加一个.就可以实现文件的隐藏，而如果运维人员在排查的时候仅仅使用ls，那么是很难排查到隐藏文件的。

可以看到直接使用ls是无法查看到1.txt文件的，必须使用ls -la来进行排查。
```
touch .1.txt
```




## **chattr命令锁文件**
这个命令在Linux系统中是用于锁定一些重要文件，避免被删除，而我们就可以利用这个命令进行伪造，来避免文件被删除，同时也能够在一定情况下忽悠运维人员以为是系统文件，从而不去删除。
```
rm-rf 1.txt
rm：无法删除1.txt：不允许的操作
```
chattr 命令参数：
```
chattr 参数 文件名
a：让文件或目录仅供附加用途。
b：不更新文件或目录的最后存取时间。
c：将文件或目录压缩后存放。
d：将文件或目录排除在倾倒操作之外。
i：不得任意更动文件或目录。
s：保密性删除文件或目录。
S：即时更新文件或目录。
u：预防意外删除。
```

#### 属性添加

这里是要+i，不是-i，相当于是给文件添加上属性。

```
chattr +i 1.txt
```


#### 属性解除

这里只要将前面的+i修改成-i即可接触属性。

```
chattr -i 1.txt
```



## **清除历史命令**

history命令是能够查询到命令执行历史的，而在我们执行木马运行命令后，如果不删除这些命令就会出现被排查的情况，那么这时候就需要将命令隐藏也就是不记录。


#### 隐藏命令
其实在执行命令的时候，在命令前面添加一个空格，那么这个命令执行就不会记录到历史记录中，
这个技巧如果在你的系统不管用，请查看下环境变量 `HISTCONTROL` 是否包含 `ignorespace`，貌似 centos 系统默认没有设置这个值。
#### 清除历史命令
```
history -c ##清除缓存
echo > ./.bash_history #彻底删除命令
```



## **清除登录日志**
这里将这些日志清除就可以避免被发现登录的IP地址等信息。
#### 清除登录成功日志
```
echo > /var/log/wtmp ##此文件默认打开时乱码，可查到ip等信息
last|grep root ##此时即查不到用户登录信息
```
#### 清除登录失败日志
```
echo > /var/log/btmp ##此文件默认打开时乱码，可查到登陆失败信息
lastb |grep root ##查不到登陆失败信息
```



