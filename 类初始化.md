## **类生命周期**
类从被加载到虚拟机内存中开始到卸载出内存为止，它的整个生命周期可以简单概括为 7 个阶段：加载（Loading）、验证（Verification）、准备（Preparation）、解析（Resolution）、初始化（Initialization）、使用（Using）和卸载（Unloading）。
其中，验证、准备和解析这三个阶段可以统称为连接（Linking）。

我们主要关注类的加载 和 初始化。
类是先加载，再根据方式确定是否要初始化，这里先讨论初始化。

## **类初始化和对象初始化**

1. **类初始化**：
   * 类初始化是指Java虚拟机（JVM）在类被加载后，对类变量（静态变量）进行初始化的过程。
   * 类初始化只发生一次，无论创建多少个该类的对象。
   * 类初始化包括执行静态变量的初始化和静态初始化块。
   * 类初始化的目的是确保类的所有静态成员都已经被正确初始化。
   * 类初始化的时机是在类被首次主动使用时，例如：
     * 创建该类的实例。
     * 访问该类的静态变量或调用静态方法。
     * 通过反射对类进行操作。
![image-20240906112545943](http://cdn.33129999.xyz/mk_img/image-20240906112545943.png)

2. **对象初始化**：
   * 对象初始化是指在创建类的新实例（对象）时，对实例变量进行初始化的过程。
   * 对象初始化对每个新创建的对象都会发生一次。
   * 对象初始化包括执行实例变量的初始化和构造方法。
   * 对象初始化的时机是在每次通过`new`关键字创建类的新实例时。
   * 对象初始化的目的是确保每个新创建的对象都拥有自己的初始状态。



^
## **相关概念和示例**
在Java中，类和对象的初始化涉及到几个不同的概念，包括类的初始化、初始化块和静态初始化块。这些概念在Java程序的执行过程中扮演着重要的角色：

1. **类的初始化**：

   * 类的初始化是指在类被加载到JVM后，JVM对 类变量（静态变量 static int a）进行初始化的过程。
   * 类的初始化只会在类第一次被使用时发生一次。
   * 类的初始化包括执行静态变量的赋值操作和静态初始化块。

2. **初始化块**（Instance Initializer Block）：

   * 初始化块是类中的一段代码块，可以包含在类体中的任何地方。
   * 初始化块可以没有声明，也可以声明为静态（static {} 静态初始化块）。
   * 非静态初始化块在每次创建类的新实例时执行，而静态初始化块只在类第一次被加载时执行一次。
   * 初始化块通常用于初始化实例变量(int a)。

3. **静态初始化块**（Static Initializer Block）：

   * 静态初始化块是类中的一个特殊的初始化块，它被声明为静态（static）。
   * 静态初始化块只在类第一次被加载到JVM时执行一次，用于初始化静态变量。
   * 静态初始化块可以有多个，它们按照它们在类中出现的顺序依次执行。

下面是一个简单的Java代码示例，展示了初始化块和静态初始化块的使用：

```
public class MyClass {
    // 静态变量
    static int staticVar = 10;

    // 静态初始化块
    static {
        staticVar = 20; // 给静态变量赋值
        System.out.println("Static initializer block executed.");
    }

    // 实例变量
    int instanceVar;

    // 初始化块
    {
        instanceVar = 30; // 给实例变量赋值
        System.out.println("Instance initializer block executed.");
    }

    public MyClass() {
        System.out.println("Constructor executed.");
    }

    public static void main(String[] args) {
        new MyClass(); // 创建类的实例
        new MyClass(); // 再次创建类的实例
        System.out.println("Static variable value: " + staticVar);
    }
}
```

在这个例子中：
* 类初始化：当`MyClass`类被首次主动使用（例如，通过`new MyClass()`创建实例）时，会发生类初始化。这包括执行静态初始化块，给`staticVar`赋值为20，并打印一条消息。
* 对象初始化：每次创建`MyClass`的新实例时，会发生对象初始化。这包括执行实例初始化块，给`instanceVar`赋值为30，并打印一条消息，以及执行构造方法，并打印一条消息。

总结来说，类初始化是针对类本身进行的，只发生一次，而对象初始化是针对每个新创建的对象进行的，每次创建新对象时都会发生。
静态初始化块和初始化块是Java中用于初始化类和对象的有用工具，它们提供了一种在对象创建之前设置初始状态的方法。



## **利用**
如：
```
public class Eval {
    // newInstance() 会自动调用静态代码块
    static {
        try {
            Runtime.getRuntime().exec("calc");
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}
```
^