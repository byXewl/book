"use strict";(self.webpackChunkTopWritePlugins_ai=self.webpackChunkTopWritePlugins_ai||[]).push([[963],{5963:(e,t,n)=>{n.r(t),n.d(t,{default:()=>he});var r,a,o=n(4685),i=n.n(o),c=n(3036),l=n(4099),s=n(9196);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(this,arguments)}var p=function(e){return s.createElement("svg",u({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:"1em",height:"1em",viewBox:"0 0 16 16",fill:"none"},e),r||(r=s.createElement("g",null,s.createElement("mask",{id:"robot_svg__b",fill:"#fff"},s.createElement("use",{xlinkHref:"#robot_svg__a"})),s.createElement("g",{mask:"url(#robot_svg__b)",fill:"currentColor"},s.createElement("path",{d:"M3.67 13.67h8.66c.002 0 .003-.001.003-.003V6.334H3.67c-.002 0-.003 0-.003.003v7.33c0 .002 0 .003.003.003zm0 1.333c-.37 0-.684-.13-.945-.391a1.288 1.288 0 0 1-.392-.945v-7.33c0-.37.13-.685.392-.946.26-.26.576-.391.945-.391h8.66c.37 0 .684.13.945.391.261.261.392.577.392.946v7.33c0 .369-.13.684-.392.945a1.288 1.288 0 0 1-.945.391z"}),s.createElement("path",{d:"M9.819 6.127a.666.666 0 0 1-1.05-.81l1.67-2.67a.665.665 0 0 1 1.107-.034.663.663 0 0 1 .023.74l-1.67 2.67a.665.665 0 0 1-.08.104zM7.293 5.434a.665.665 0 0 1-1.01.779.665.665 0 0 1-.178-.19l-1.67-2.67a.665.665 0 0 1 .952-.896.665.665 0 0 1 .178.19l1.67 2.67a.665.665 0 0 1 .058.117z"}),s.createElement("path",{d:"M11.337 2.333c-.003 0-.004.001-.004.004l-.001-.01a.007.007 0 0 0 .005.003h-.007v.007c0-.002 0-.004-.002-.005l.009.001zm0-1.333c.366 0 .679.131.939.394.258.261.387.575.387.943 0 .364-.13.676-.39.936s-.572.39-.936.39c-.368 0-.682-.129-.943-.388A1.273 1.273 0 0 1 10 2.337c0-.37.13-.685.391-.946.262-.26.577-.391.946-.391zM4.67 2.333c-.002 0-.003.001-.003.004 0-.005 0-.008-.002-.01a.007.007 0 0 0 .005.003h-.006v.007c0-.002-.001-.004-.003-.005l.009.001zM4.67 1c.366 0 .679.131.939.394.258.261.388.575.388.943 0 .364-.13.676-.39.936s-.573.39-.937.39c-.367 0-.681-.129-.943-.388a1.273 1.273 0 0 1-.394-.938c0-.37.13-.685.392-.946.26-.26.576-.391.945-.391zM6.663 10.003h2.67c.184 0 .34-.065.469-.194a.655.655 0 0 0 .195-.479.638.638 0 0 0-.196-.467.638.638 0 0 0-.468-.196h-2.67a.638.638 0 0 0-.467.196A.638.638 0 0 0 6 9.33c0 .188.065.347.195.479.128.13.284.194.468.194zm0 1.334a1.974 1.974 0 0 1-1.416-.59 2.001 2.001 0 0 1 1.416-3.413h2.67a1.99 1.99 0 0 1 1.41.587 1.99 1.99 0 0 1 .587 1.409 2.002 2.002 0 0 1-1.997 2.007zM2 10.663h1.003a.666.666 0 1 1 0 1.334h-1.67a.666.666 0 0 1-.666-.667V8a.665.665 0 0 1 .666-.667h1.67a.665.665 0 0 1 .555 1.037.665.665 0 0 1-.555.297H2zM14.8 7.346a.664.664 0 0 1 .537.654v3.33a.666.666 0 0 1-.667.667H13a.666.666 0 1 1 0-1.334h1.003V8.667H13a.665.665 0 0 1-.471-1.138.664.664 0 0 1 .471-.196h1.67c.044 0 .087.005.13.013z"})))),a||(a=s.createElement("defs",null,s.createElement("rect",{id:"robot_svg__a",x:0,y:0,width:"1em",height:"1em"}))))};var d,v,f=n(3309),h=n.n(f);function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},g.apply(this,arguments)}var m=function(e){return s.createElement("svg",g({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"translate_svg__text-gray-500"},e),d||(d=s.createElement("path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05"})),v||(v=s.createElement("circle",{cx:12,cy:12,r:10})))};var b,w,x;function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},y.apply(this,arguments)}var j=function(e){return s.createElement("svg",y({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"extend_svg__text-gray-500"},e),b||(b=s.createElement("circle",{cx:12,cy:12,r:1})),w||(w=s.createElement("circle",{cx:19,cy:12,r:1})),x||(x=s.createElement("circle",{cx:5,cy:12,r:1})))};var k;function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},E.apply(this,arguments)}var _=function(e){return s.createElement("svg",E({xmlns:"http://www.w3.org/2000/svg",width:18,height:18,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"shorten_svg__text-gray-500"},e),k||(k=s.createElement("path",{d:"M12 22v-6M12 8V2M4 12H2M10 12H8M16 12h-2M22 12h-2M15 19l-3-3-3 3M15 5l-3 3-3-3"})))};var M,O;function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C.apply(this,arguments)}var z=function(e){return s.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),M||(M=s.createElement("defs",null,s.createElement("path",{id:"run_svg__a",d:"M0 0h16v16H0z"}))),O||(O=s.createElement("mask",{id:"run_svg__b",fill:"#fff"},s.createElement("use",{xlinkHref:"#run_svg__a"}))),s.createElement("g",{mask:"url(#run_svg__b)"},s.createElement("path",{transform:"translate(1.333 2)",d:"M0 4.71 6.67 6l1.67 6.67L12.67 0 0 4.71Z",style:{stroke:"currentColor",strokeWidth:1.33333,strokeOpacity:1,strokeDasharray:"0,0"}}),s.createElement("path",{transform:"translate(8.003 6.117)",d:"M0 1.89 1.89 0",style:{stroke:"currentColor",strokeWidth:1.33333,strokeOpacity:1,strokeDasharray:"0,0"}})))};var L,P;function N(){return N=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},N.apply(this,arguments)}var F=function(e){return s.createElement("svg",N({className:"polish_svg__icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:128,height:128},e),L||(L=s.createElement("path",{d:"m768 972.8-73.143-131.657L563.2 768l131.657-73.143L768 563.2l73.143 131.657L972.8 768l-131.657 73.143L768 972.8zM716.8 768l29.257 14.629 14.629 29.257 14.628-29.257L804.571 768l-29.257-14.629-14.628-29.257-14.629 29.257L716.8 768zm-373.029 73.143L226.743 629.029 14.629 512l212.114-117.029L343.77 182.857 460.8 394.971 665.6 512 453.486 629.029 343.77 841.143zM168.23 512l109.714 58.514 58.514 109.715 58.514-109.715L512 512l-109.714-58.514L343.77 343.77l-58.514 109.715L168.23 512zm555.885-138.971-58.514-102.4-102.4-58.515L665.6 153.6l58.514-102.4 58.515 102.4 102.4 58.514-102.4 58.515-58.515 102.4zM716.8 212.114h14.629H716.8z",fill:"currentColor"})),P||(P=s.createElement("path",{d:"M768 219.429C768 241.37 753.371 256 731.429 256s-36.572-14.629-36.572-36.571 14.629-36.572 36.572-36.572S768 197.486 768 219.43zm109.714 570.514c-36.571 51.2-51.2 51.2-109.714 51.2s-73.143 0-109.714-51.2c0-58.514 51.2-109.714 109.714-109.714s109.714 43.885 109.714 109.714z",fill:"currentColor"})))};var H=n(9221),B=n.n(H),S=n(8823),V=n.n(S),A=(n(3708),n(914),n(7802),n(9507),n(9323));function W(){return function(e){var t=n(1181);return e.getPluginConfig("ai",t)}((0,l.useBook)().config)}var D=(0,s.createContext)({loading:!1,result:"",append:!1,error:!1,controller:void 0,run:function(){return Promise.resolve()}});const q=D;var T,J,X,Z=function(e){var t=e.children,n=W(),r=(0,s.useState)(!1),a=i()(r,2),o=a[0],l=a[1],u=(0,s.useState)(""),p=i()(u,2),d=p[0],v=p[1],f=(0,s.useState)(),h=i()(f,2),g=h[0],m=h[1],b=(0,s.useState)([]),w=i()(b,2),x=w[0],y=w[1],j=(0,s.useState)(!1),k=i()(j,2),E=k[0],_=k[1],M=(0,s.useState)(!1),O=i()(M,2),C=O[0],z=O[1],L=(0,s.useCallback)(function(){var e=B()(V().mark((function e(t){var r,a,o,i,c,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.getValue("endpoint","https://ai.topthink.com/chat/completions"),a=n.getValue("token")){e.next=6;break}return v("[令牌未设置]"),z(!0),e.abrupt("return");case 6:return t?(y(t.messages),_(null!==(i=t.append)&&void 0!==i&&i),o=t.messages):o=x,v(""),l(!0),z(!1),c=!1,(s=new AbortController).signal.onabort=function(){c=!0,l(!1),m(void 0)},m((function(e){return null==e||e.abort(),s})),e.next=16,(0,A.L)(r,{method:"POST",body:JSON.stringify({messages:o}),signal:s.signal,headers:{"content-type":"application/json",accept:"text/event-stream,application/json",authorization:"Bearer ".concat(a)},onopen:function(e){return B()(V().mark((function t(){var n,r,a;return V().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ok&&null!==(n=e.headers.get("content-type"))&&void 0!==n&&n.startsWith(A.a)){t.next=18;break}if(c=!0,r="网络错误，请重试",403!==e.status&&401!==e.status){t.next=7;break}r="令牌已过期或无权限",t.next=16;break;case 7:return t.prev=7,t.next=10,e.clone().json();case 10:a=t.sent,r=a.message||"",t.next=16;break;case 14:t.prev=14,t.t0=t.catch(7);case 16:v("[".concat(r,"]")),z(!0);case 18:case"end":return t.stop()}}),t,null,[[7,14]])})))()},onmessage:function(e){if("[DONE]"===e.data||c)c=!0;else try{var t=JSON.parse(e.data);v((function(e){return e+t}))}catch(e){}},onerror:function(e){c=!0,l(!1),m(void 0),v("[".concat(e.message,"]")),z(!0)},onclose:function(){c=!0,l(!1),m(void 0)},openWhenHidden:!0});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[x,n]);return(0,s.useEffect)((function(){return function(){null==g||g.abort()}}),[g]),(0,c.jsx)(D.Provider,{value:{loading:o,result:d,append:E,error:C,controller:g,run:L},children:(0,c.jsx)(D.Consumer,{children:t})})};n(3279),n(2378);function R(e){var t=e.icon,n=e.title,r=e.prompt,a=e.append,o=(0,s.useContext)(q).run,i=(0,l.useEditor)(),u=(0,l.useBook)(),p=u.config,d=u.summary,v=(0,l.useFile)(),f=d.getArticle((function(e){return e.ref===v.path})),h=(0,s.useCallback)(function(){var e=B()(V().mark((function e(t){var n,c,l,s,u,d;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=i.serializer.serialize(i.getFragment()),c=[],"function"==typeof r?c=r(n):(l=p.getValue("title"),s=l?"【".concat(l,"】的"):"",u=f?"正在编写章节[".concat(f.title,"]，"):"",d=r.replace("{content}",n).replace("{book}",s).replace("{chapter}",u),c=[{role:"user",content:d}]),e.next=6,o({messages:c,append:a});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i,p,f]);return(0,c.jsxs)("div",{className:"list-group-item list-group-item-action",role:"button",onMouseDown:h,children:[t,n]})}function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},G.apply(this,arguments)}var I=function(e){return s.createElement("svg",G({xmlns:"http://www.w3.org/2000/svg",width:30,height:14,fill:"#fff",viewBox:"0 0 120 30"},e),T||(T=s.createElement("circle",{cx:15,cy:15,r:15,fill:"#FFF"},s.createElement("animate",{attributeName:"r",begin:"0s",calcMode:"linear",dur:"0.8s",from:15,repeatCount:"indefinite",to:15,values:"15;9;15"}),s.createElement("animate",{attributeName:"fill-opacity",begin:"0s",calcMode:"linear",dur:"0.8s",from:1,repeatCount:"indefinite",to:1,values:"1;.5;1"}))),J||(J=s.createElement("circle",{cx:60,cy:15,r:9,fill:"#FFF",fillOpacity:.3},s.createElement("animate",{attributeName:"r",begin:"0s",calcMode:"linear",dur:"0.8s",from:9,repeatCount:"indefinite",to:9,values:"9;15;9"}),s.createElement("animate",{attributeName:"fill-opacity",begin:"0s",calcMode:"linear",dur:"0.8s",from:.5,repeatCount:"indefinite",to:.5,values:".5;1;.5"}))),X||(X=s.createElement("circle",{cx:105,cy:15,r:15,fill:"#FFF"},s.createElement("animate",{attributeName:"r",begin:"0s",calcMode:"linear",dur:"0.8s",from:15,repeatCount:"indefinite",to:15,values:"15;9;15"}),s.createElement("animate",{attributeName:"fill-opacity",begin:"0s",calcMode:"linear",dur:"0.8s",from:1,repeatCount:"indefinite",to:1,values:"1;.5;1"}))))};var K,Q;function U(){return U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},U.apply(this,arguments)}var Y=function(e){return s.createElement("svg",U({className:"stop_svg__icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:16,height:16},e),K||(K=s.createElement("path",{d:"M512 42.667A469.333 469.333 0 1 0 981.333 512 469.333 469.333 0 0 0 512 42.667zm0 864A394.667 394.667 0 1 1 906.667 512 395.147 395.147 0 0 1 512 906.667z",fill:"currentColor"})),Q||(Q=s.createElement("path",{d:"M370.667 365.333h282.666q5.334 0 5.334 5.334v282.666q0 5.334-5.334 5.334H370.667q-5.334 0-5.334-5.334V370.667q0-5.334 5.334-5.334Z",fill:"currentColor"})))};var $;function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ee.apply(this,arguments)}var te=function(e){return s.createElement("svg",ee({className:"reload_svg__icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:16,height:16},e),$||($=s.createElement("path",{d:"M756.821 256c-65.28-52.736-155.349-85.333-244.821-85.333A341.333 341.333 0 1 0 853.333 512a42.667 42.667 0 0 1 85.334 0c0 235.648-191.019 426.667-426.667 426.667S85.333 747.648 85.333 512 276.352 85.333 512 85.333c108.757 0 217.899 39.083 298.667 104.491V128A42.667 42.667 0 0 1 896 128v170.667a42.667 42.667 0 0 1-42.667 42.666H682.667a42.667 42.667 0 0 1 0-85.333h74.154z",fill:"currentColor"})))};var ne,re,ae;function oe(){var e=(0,s.useContext)(q),t=e.loading,n=e.result,r=e.controller,a=e.run,o=e.append,i=e.error,u=(0,l.useEditor)(),p=(0,s.useRef)(null),d=(0,s.useCallback)((function(){var e=p.current;e&&requestAnimationFrame((function(){return e.scrollTo(0,e.scrollHeight)}))}),[]);(0,s.useEffect)((function(){d()}));var v=(0,s.useCallback)((function(){if(n){var e=o?u.serializer.serialize(u.getFragment()):"",t=u.serializer.deserialize(e+n);u.insertFragment(t)}}),[n,o]),f=(0,s.useCallback)((function(){null==r||r.abort()}),[r]),h=(0,s.useCallback)((function(){a()}),[]);return(0,c.jsx)(ue,{children:n?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(se,{ref:p,children:n}),(0,c.jsxs)(le,{children:[(0,c.jsx)("div",{children:t?(0,c.jsx)(l.Button,{variant:"secondary",onMouseDown:f,children:(0,c.jsx)(Y,{})}):(0,c.jsx)(l.Button,{variant:"secondary",onMouseDown:h,children:(0,c.jsx)(te,{})})}),(0,c.jsx)("div",{children:(0,c.jsx)(l.Button,{loading:t,disabled:i,onMouseDown:v,children:"插入"})})]})]}):(0,c.jsx)(I,{})})}var ie,ce,le=l.styled.div(ne||(ne=h()(["\n    justify-content: space-between;\n    display: flex;\n"]))),se=l.styled.div(re||(re=h()(["\n    background-color: var(--ttw-background);\n    border: 1px solid var(--ttw-border-color);\n    padding: .5rem;\n    border-radius: 0.375rem;\n    height: 250px;\n    font-size: 15px;\n    white-space: pre-wrap;\n    word-break: break-all;\n    overflow-x: hidden;\n    overflow-y: auto;\n"]))),ue=l.styled.div(ae||(ae=h()(["\n    padding: 1rem;\n    width: 500px;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n"])));function pe(){var e=W().getValue(["translate","target"],"英文");return(0,c.jsx)(ve,{children:(0,c.jsx)(Z,{children:function(t){var n=t.loading,r=t.result;return n||r?(0,c.jsx)(oe,{}):(0,c.jsxs)(de,{className:"list-group",children:[(0,c.jsx)(R,{icon:(0,c.jsx)(F,{}),title:"润色",prompt:"我希望你能帮我润色下面的内容，使其更加流畅，优美，尽量保留原有的Markdown格式。请润色以下内容：\\n\\n{content}"}),(0,c.jsx)(R,{icon:(0,c.jsx)(j,{}),title:"续写",prompt:"下面我让你来充当文档{book}作者，{chapter}我希望你能帮我续写下面的内容。请续写以下内容：\\n\\n{content}",append:!0}),(0,c.jsx)(R,{icon:(0,c.jsx)(_,{}),title:"精简",prompt:"我希望你能帮我将下面的内容精简一下，尽量保留原有的Markdown格式。请精简以下内容：\\n\\n{content}"}),(0,c.jsx)(R,{icon:(0,c.jsx)(m,{}),title:"翻译为".concat(e),prompt:"请将以下内容翻译成".concat(e,"：\n\n{content}")}),(0,c.jsx)(R,{icon:(0,c.jsx)(z,{}),title:"执行",prompt:"{content}"})]})}})})}var de=l.styled.div(ie||(ie=h()(["\n    width: 150px;\n    --bs-list-group-bg: var(--ttw-box-background);\n    --bs-list-group-color: var(--ttw-box-color);\n    --bs-list-group-action-hover-color: var(--ttw-box-color);\n    --bs-list-group-action-hover-bg: var(--ttw-box-hover-background);\n    --bs-list-group-action-active-color: var(--ttw-box-color);\n    --bs-list-group-action-active-bg: var(--ttw-box-active-background);\n    --bs-list-group-border-width: 0;\n\n    .list-group-item {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n\n        svg {\n            width: 14px;\n            height: 14px;\n        }\n    }\n"]))),ve=l.styled.div(ce||(ce=h()(["\n    position: absolute;\n    top: 38px;\n    left: 0;\n    line-height: 1.5;\n    box-shadow: 0 0.5rem 1rem rgb(0 0 0 / 15%);\n    user-select: auto;\n    background-color: var(--ttw-box-background);\n    color: var(--ttw-box-color);\n    border-radius: 0.375rem;\n"]))),fe=(0,l.createMarkdownPlatePlugin)({hoverTools:function(){return{5:function(e){var t=e.Component,n=(0,s.useState)(!1),r=i()(n,2),a=r[0],o=r[1];return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(t,{handler:function(){return o(!a)},active:a,icon:(0,c.jsx)(p,{})}),a&&(0,c.jsx)(pe,{})]})}}}});function he(e){var t=e.children,n=(0,l.useActions)("editor"),r=n.addPlugin,a=n.removePlugin;return(0,s.useEffect)((function(){return r(fe),function(){a(fe)}}),[]),t}}}]);
//# sourceMappingURL=963-9458a7.js.map