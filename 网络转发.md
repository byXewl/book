# **虚拟专用网VPN（IP隧道技术）**
允许用户在公共网络上建立私密的、加密的连接，仿佛在一个私人网络中一样进行通信。


MPLS（Multiprotocol Label Switching）是一种网络技术，它在网络中引入标签（Label）来对数据包进行标识和转发，实现VPN。
例：
部门A局域网在北京
部门B局域网在上海
两个局域网要连接：
1.租用电信公司的通信线路，成本高。
2.利用两端申请公网ip连接公用因特网开一个虚拟专用通道(加密解密)
<br>

### **私有（专用，私有）地址：**
10.0.0.0 ~ 10.255.255.255（10/8地址块） 属于A段，用于大型企业的内部网络。
172.16.0.0 ~ 172.31.255.255   属于B段，用于中型企业。
192.168.0.0 ~ 192.168.255.255  属于C段，用于小型组织、家庭网络或小型办公网络，提供了65,536个IP地址，通常用于小型企业或个人用户的内部网络。
不唯一，只能用作本地地址，专用网，内网。
### **公网地址：**
全球唯一IP地址，公网地址，与因特网相连接。


IP地址25.2.182.2是一个公网IP吗？
IPv4的私有IP有3个IP段：
10.0.0.0 ~ 10.255.255.255，172.16.0.0 ~ 172.31.255.255，192.168.0.0 ~ 192.168.255.255，
提及的25.2.182.2不在上述三个IP段内，不属于私有IP。
<br>


# **NAT网络地址转换**
NAT路由器：装有NAT软件，可动态分配全球IP地址。
<br>
### **NAT转发：**
请求发送
1.路由器修改IP数据报的源地址为分配的全球IP地址
2.NAT表中纪录这个全球IP和源主机IP的对应关系
3.转发IP数据报(这个数据报的源IP和目的服务器IP都是全球IP地址)
响应返回
1.路由器接收IP数据报（这个数据报的源IP为公网服务器IP,目的IP为该路由器的全球IP）的目的IP 根据 NAT转化表 找到内部主机的专用IP。
2.主机接收IP数据报（这个数据报的源IP为公网服务器IP,目的IP为该主机专用IP）
<br>
**NAT转换表**: 字段（内部IP，内部IP端口，公共IP，公共IP端口，协议）
**NAPT网络地址与端口转换**：一个公网IP的不同端口转发不同的内网IP。
<br>
家用路由器进行路由转发同时对报文进行NAT转发：
入口LAN端：局域网IP
出口WAN端：广域网公网IP
WAN出口再发送到服务器IP
<br>
# **内网穿透/端口转发**
NAT转发解决了内部主机访问外网（出网）。
但NAT转发无法解决外部的外网IP**主动**向内部的主机通信（NAT转发表中无记录）
而内网穿透和端口转发可以用于使外部网络能够访问内部网络中的设备或服务。它们用于解决内部网络设备无法直接被外部网络访问的问题。

### **内网穿透** (NAT Traversal)

内网穿透是指使外部网络可以直接访问内部网络中的设备或服务的技术。它通过穿透网络边界，允许外部网络访问内部网络中的设备或服务。一些情况下，内网穿透可能需要通过中间服务器或服务（cloudfkare,花生壳）来建立连接，以允许外部设备访问内部设备。
<br>
**1. frp**：是一个开源的内网穿透工具，用于通过建立连接将内部网络的服务暴露到公共网络中。它可以通过服务器（frp服务器）作为中继，在内网和外网之间建立安全的连接，实现内网穿透。frp支持TCP、UDP、HTTP、HTTPS等不同类型的流量转发，并且具有较强的自定义配置能力。
<br>
**2. 花生壳**：是一种内网穿透服务，它允许用户在内部网络中的设备或服务能够被外部网络访问。通过花生壳等类似服务，用户可以将内网设备暴露到外部网络，实现远程访问、监控或控制。

1. 安装客户端： 用户需要在花生壳官网注册账户并登录，然后安装并运行花生壳客户端软件。

2. 客户端设置： 在花生壳客户端中，用户需要添加需要进行内网穿透的设备或服务信息。这可能包括设备的本地IP地址、端口号以及服务类型。

3. 开启服务器： 花生壳会创建一个专门的服务器来协助内网穿透。这个服务器会与客户端建立连接，维护内部设备的映射表。

4. 开启内网设备映射： 花生壳服务器与客户端建立连接后，会维护一个映射表，将外部网络请求映射到用户设定的内网设备或服务。

5. 开启外部访问： 当外部网络请求到达花生壳服务器时，它会根据映射表，将这个请求转发到用户在内网设置的设备或服务上。
<br>

### **端口转发** (Port Forwarding)
若你的设备有公网 IP 地址，实现端口转发是一种简单且常见的方式，允许外部网络通过指定端口访问你内部网络的特定设备或服务。这是在路由器、防火墙或类似设备上进行的设置。

实现端口转发的步骤通常包括：

1. 拥有公网 IP 地址： 确认你的设备有一个公网 IP 地址，这是外部网络访问你网络的入口地址。

2. 配置端口转发规则： 在路由器或防火墙设置中，创建一个端口转发规则。规则通常包括外部端口（外部网络发送请求的端口）、目标设备的内部IP地址、目标设备的端口。

3. 请求转发： 一旦设置了转发规则，外部网络通过公网 IP 的特定端口发送请求时，路由器将这些请求转发到设备的指定端口上。

这种方法适用于你的设备有公网 IP 地址并且有权限在路由器或防火墙中进行配置的情况。这样可以让外部网络访问你内部网络的特定服务或设备。

需要注意的是，公网 IP 地址和端口转发可以让你的内部网络暴露在公网上，这会增加一些安全风险。因此，在配置端口转发时需要谨慎，并确保设备和服务有适当的安全设置以防止未经授权的访问。


# **个人用户与公网IP的关系**
在使用电信公司的4G网络流量时，个人用户和公网IP之间的关系有所不同，特别是在移动网络环境下：

1. **动态分配的公网IP**：
   - 通常情况下，当个人用户使用电信公司的4G网络时，电信公司会为用户动态分配一个公网IP地址。这个IP地址可能是临时的，因为电信公司在为其用户提供互联网服务时使用动态IP分配，这意味着在不同时间或会话结束后，用户可能会分配不同的IP地址。

2. **NAT（网络地址转换）**：
   - 在移动网络环境中，运营商会使用NAT技术，允许多个用户共享一个公网IP地址。这种共享使得单个公网IP地址能够为多个用户提供互联网连接。在这种情况下，用户的设备（例如手机）通常会获得一个局域网内的私有IP地址，而通过运营商的NAT网关，所有这些设备的流量都会经过相同的公网IP地址。

3. **移动网络的路由器**：
   - 在移动网络中，电信公司的网络会通过其自己的设备和路由器，为用户设备提供互联网连接。这些设备为用户提供了连接到互联网的通道，并使用NAT技术将用户设备的流量路由到共享的公网IP地址上。

因此，对于个人用户使用电信公司的4G网络，通常会有动态分配的公网IP地址，但这个IP地址可能是临时的，并且可能会被多个用户共享。个人设备在这种情况下通常会被分配一个私有IP地址，而整个流量都会经过电信公司的网络设备，使用NAT技术进行连接和路由。

某个IP分配给了一个拨号ADSL运营商，当它的一个用户拨号后占用了这个IP地址，但该用户下线后这个IP地址就可能分配给了其他拨号的用户，该用户再次拨号上网后被分配了另外一个IP地址。所以只能确定这个IP在这个城市内使用，但无法确定这个IP在某个更小的区域、街道、房间使用。

但是，这个运营商是拥有哪个用户在哪个时间内使用了某个IP地址的日志记录，如果有必要（例如在ga要求下），运营商可以查出一个IP地址某个时间内更准确的用户信息和地理定位。

