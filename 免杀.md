对webshell，fscan，mimikatz，frp，cs后门做免杀，流量魔改。
对后门做免杀，防止被杀软(杀毒软件、入侵检测系统（IDS/IPS）、主机防火墙)清除。


^
## **免杀的原理**
免杀的原理主要是通过对恶意代码进行修改、混淆、加密、伪装等技术，使得恶意代码在传输和执行过程中不被安全防御产品和服务所检测到。以下是一些常见的免杀技术：

1. **多层加密和混淆：** 使用多层加密和混淆技术对恶意代码进行编码，使其在传输和存储过程中难以被检测到。这可以包括使用加密算法、混淆变量和函数名、添加无用代码等手段。
2. **变形和模糊：** 对恶意代码进行变形和模糊处理，使其生成不同的变体和版本，以逃避基于签名或模式匹配的检测。这可以包括使用自动化工具生成变异代码、改变代码结构、调整指令顺序等。
3. **绕过安全检测：** 分析目标系统上安全产品和服务的工作原理，并设计恶意代码以绕过检测。例如，利用已知漏洞或弱点、绕过沙箱环境、规避行为分析等。
4. **反向工程和逆向分析：** 对目标系统上安全产品和服务进行反向工程和逆向分析，分析其检测和防御机制，并设计恶意代码以规避这些机制。


^
## **杀软原理**
**静态查杀原理**
静态查杀是杀毒软件中最早出现且最常用的查杀方式之一。它的主要原理包括：
1、特征码识别：杀毒软件通过提取病毒文件的特征码（如文件MD5值、唯一存在的一段字符串等）进行比对，如果匹配则报毒并查杀。这种方法简单、快捷，但容易被加壳技术绕过。
2、云查杀：病毒库存储在服务器端，通过网络实时更新，增强了查杀能力。
3、校验和法：通过计算文件的校验和，定期检查文件内容是否被篡改。
4、启发式扫描：通过归纳总结病毒的特征，识别未知病毒。例如，使用YARA规则进行模式匹配。

绕过：通过反复加密文件，内存加载执行来绕过静态查杀等方法。

**动态查杀原理**
动态查杀，也称为主动防御，是在程序运行过程中通过监控其行为来识别和查杀病毒的技术。其主要原理包括：
1、沙盒技术：通过在隔离环境中运行可疑程序，监控其行为，判断是否为病毒。沙盒能够检测到内存较小、时间较快、进程或文件不完整、Io设备缺失等特征。
2、行为监控：监控程序的文件操作、注册表操作、网络操作、进程操作、线程操作、关键函数调用等行为，从而综合判断是否是病毒。
3、主动防御：通过行为判断来识别未知病毒和变种，例如自删除、自启动、释放文件、调用敏感的DLL等。
4、云查杀：将可疑文件上传到服务器进行进一步分析，利用分布式的杀软节点构建“云大脑”，有效识别和防御病毒。
5、AI查杀：利用机器学习技术，依托庞大的病毒样本库进行模型训练，快速、准确地判断变种病毒木马。


^
## **各方面涉及**

编译代码面-ShellCode-混淆
编译代码面-编辑执行器-编写
编译代码面-分离加载器-编写
程序文件面-特征码定位-修改
程序文件面-加壳花指令-资源
代码加载面-Dll 反射劫持-加载
权限逻辑面-杀毒进程干扰-结束
工具数据面-通讯内存流量-动态

shellcode+加载器 ：免杀 手法多。不易损坏。
可执行文件：免杀 手段单一，加壳 加花指令。损坏可能性大。
^
## **对抗目标**
防病毒软件（Antivirus，简称AV）
X60全家桶 Defender 某绒 管家 VT(沙箱virustotal.com) 等。

免杀成功：
程序落地后，没有被 某绒 杀，三分钟后还没有被x60杀(三分钟内可以上线，但是三分钟后就断了)，则免杀成功。 



编程语言：
C/C++ Python C# Go Powershell Ruby Java ASM汇编等。
涉及技术：
ShellCode 混淆加密，无文件落地，分离拆分，白名单，DLL 加载，Syscall，加壳加花，
资源修改，特征修改，二次开发 CS，内存休眠，进程注入，反沙盒，反调试，CDN 解析等。
^
免杀对抗对象：源代码 EXE DLL ShellCode 其他（文档，手机等）
目标：火R X60桶 DF 卡巴 Nod32 麦咖啡 EDR产品等
卡巴斯基下载：<https://www.bilibili.com/video/BV1tH4y1a7CS/>

对抗：静态特征 动态行为 云查杀 启发式 主动防御 AI等
技术：开发魔改 加密混淆 反沙箱 虚拟机恶意加载等
1、魔改：CS/MSF/Mimikatz/哥斯拉/Fscan/Frp等
2、Shellcode：加密混淆 隐写不落地 内存封装 黑白配等
3、静态部署：加密手法，特征码，白加黑，抗沙箱抗调试，隐写分离等
4、运行行为：API操作，注入劫持，回调函数，绕过DEP，远程注入等
比如这些行为：注册表操作，添加启动项，添加服务文件写入、读系统文件、删除文件，移动文件杀进程，创建进程注入、劫持等


^
## **参考文章**
小迪逆向虚拟机
链接：https://pan.baidu.com/s/1qbmZqfgzCBm9BB7_4uen0A 
提取码：xiao 
密码：toor  需要关闭hyper-v

<https://blog.csdn.net/guanjian_ci/article/details/139295929>

go免杀学习路线：


|       |                         |                                                                                              |     |
| ----- | ----------------------- | -------------------------------------------------------------------------------------------- | --- |
|  顺序 | 介绍                    | 内容                                                                                           |     |
| 1     | Cobalt Strike必备知识       | cs目录结构 服务端客户端的部署运行 cs菜单栏详情 cs上线木马流程 Staged和Stageless区别 cs的Beacon介绍以及多种上线方式                 |  |
| 2     | Cobalt Strike特征修改和vps部署 | cs特征修改 编写cs的profile文件 cs上线linux主机 vps快速部署cs环境 为什么要用课上内部cs                                    | |
| 3     | shellcode和加载器           | 什么是shellcode shellcode文件 cs的shellcode文件 shellcode加载器原理 初识C/python加载器 编译exe的trick             |  |
| 4     | 杀软查杀原理和shellcode处理      | 杀软介绍 静态查杀原理 动态查杀原理 shellcode常规加密 shellcode内存加解密 shellcode分离                                  |  |
| 5     | shellcode运行方式           | 指针运行 创建线程运行 回调函数运行等多种方式 动态调用api(隐藏导入表中的函数) 补充shellcode处理(uuid,mac,ip地址等)                     |  |
| 6     | 编译器和exe文件处理             | 揭秘360为何查杀hello wolrd vs,gcc等编译器对比 添加数字签名 添加资源 加壳免杀 文件熵值                                      |  |
| 7     | 反沙箱                     | 什么是沙箱 沙箱工作原理 常规反沙箱 分离加载 参数启动 获取沙箱运行环境信息 微步云沙箱全绿                                              |  |
| 8     | 白加黑                     | 白加黑原理 dll**文件讲解 制作白加黑上线cs 直播现场挖白加黑                                                           | |
| 9     | go编写加载器                 | go环境搭建 第一个go程序 go调用windows api go编写各种加载器 go编译trick                                           |  |
| 10    | 谁说go过不了360?             | 通过n次编译调试,探寻360免杀技巧 多说无益,现场免杀,包过核晶和云传 讲真东西,真免杀,总结的trick直接分享出来 什么叫做真正免杀360 武器化pakcer,内置53种免杀方式 | |
| 11    | 从火绒查杀原理绕过免杀             | 手搓代码,多次调试 通过报毒,反向总结技巧 科学绕过火绒,一次绕过,次次绕过                                                       |  |
| 12    | 不允许还有人过不了defender       | defender静态查杀绕过 defender规避内存查杀 有阶段和无阶段用哪个 配置profile文件,内存混淆 轻轻松松上线cs                           |  |
| 13    | 免杀走进攻防实战                | webshell下bypass360上线cs 无法执行命令bypass 木马落地文件夹的考究 如何正确执行免杀马 绕过360进行提权                           | |
| 14    | 后渗透工具免杀                 | mimikatz工具免杀 fscan**免杀制作 通用工具免杀思路                                                            |  |
| 15    | 360福利课                  | 文件名上的查杀 运行参数的查杀 指定目录的查杀 360小怪癖点总结 绕过360添加用户                                                  |     |

