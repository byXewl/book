![image-20231107114520544](http://cdn.33129999.xyz/mk_img/image-20231107114520544.png)
一台企业内的主机通过内部网关和外部网关连接到互联网的过程通常如下：

1. **内部主机**：企业内的主机是指企业员工使用的计算机、服务器或其他设备。这些主机通常在企业内部网络中，并具有私有IP地址。它们需要连接到互联网，以便访问外部资源，如网站、电子邮件服务器等。
2. **内部网络**：企业内部网络由内部主机和网络设备组成，如交换机和内部网关路由器。这些设备用于将内部主机连接到内部网关。
3. **内部网关**：内部网关是用于连接企业内部网络与外部网关之间的网络设备。它可以是一台路由器，也可以是一组路由器和交换机。内部网关通常具有两个网络接口，一个接口连接到企业内部网络，另一个接口连接到外部网关。
4. **外部网关**：外部网关是连接企业内部网络与互联网之间的网络设备。通常，这是由互联网服务提供商（ISP）提供的设备。外部网关连接到互联网，并通常具有一个或多个公共IP地址，用于代表企业内部网络与互联网通信。
5. **NAT（网络地址转换）**：在内部网关处，通常会配置NAT。NAT将内部网络的私有IP地址映射到外部网关上的公共IP地址。这允许多个内部主机共享一个公共IP地址以访问互联网。当内部主机发送数据包到互联网时，内部网关会将源IP地址修改为其公共IP地址，以确保数据包可以在互联网上正确路由。
6. **路由规则**：内部网关通常配置有路由规则，以指示数据包如何进出内部网络。这些规则确定了数据包的路由路径。内部网关将内部主机的数据包传递给外部网关，然后由外部网关将它们连接到互联网。
7. **互联网访问**：内部主机发送请求到互联网，请求可能包括访问网站、发送电子邮件等。内部主机的数据包经过内部网关和外部网关，最终到达互联网。
8. **响应返回**：外部网关接收到互联网上的响应数据包，将其转发到内部网关。内部网关根据NAT映射将响应数据包传递到相应的内部主机。

这个过程确保了企业内的主机可以与互联网进行通信。内部网关和外部网关在其中起到关键作用，它们充当了企业内部网络与互联网之间的桥梁，同时提供了安全性和地址转换。


堡垒机：<https://img2023.cnblogs.com/blog/1080590/202212/1080590-20221230163819006-279554238.png>
