# **路由与路由表**
默认网关：IP数据包传输给默认网关。
1.路由器会检测IP数据包的首部是否出错，若出错则抛弃并告知源主机。
2.路由器根据IP数据包的目的地址在路由表中查找匹配的条目：在没有默认路由的情况下，若找到匹配的条目，则转发给条目中指示的下一跳，否则丢弃该IP数据报并ICMP告知源主机。
### **路由转发：**
路由转发：一个网络与另一个网络转发数据的动作。
### **路由表：**
字段（目的网络，地址掩码，下一跳的路由入口IP，出口接口）
地址掩码与目的IP相与属于目的网络，则走下一跳
**默认最长前缀匹配**：下一跳走目的IP与目的网络网络地址的网络号最长的匹配。
<br>
### **路由：**
路由是指确定数据包从源到目的地的最佳路径的过程。


### **静态路由：**
静态路由配置：小规模网络人工配置路由表。
1.方式简单，开销小。但不能及时适应网络状态的变化。
2.可能导致路由环路（配置出错，网络故障）。
<br>
**特定主机路由**：192.168.2.1/32  
**默认路由**： 0.0.0.0/0
默认路由是用于处理未知目的地的通用路由，而特定主机路由则是用于特定目的地址的精确路由。
默认路由：当一个数据包到达路由器或设备，如果它的目的地址不匹配任何更具体的路由，那么就会使用默认路由来转发这个数据包。默认路由通常用于将所有未知目的地的流量发送到网络的默认网关（默认的下一跳地址）。
特定主机路由： 特定主机路由是指定特定目的地地址的路由。当一个数据包的目的地地址与特定主机路由中定义的地址完全匹配时，路由器或设备会使用这个特定的路由来转发数据包。特定主机路由用于明确指定某个IP地址的下一跳路由或出口，以确保数据包直接到达特定的目标主机。
<br>
解决路由环路永久兜圈：
1.在IP数据报首部加TTL字段，每进入一次路由器，TTL值减1，若大于0则转发。否则丢弃，并向源发送“生存时间超时”的 ICMP 错误消息。

2.人工配置有效的黑洞静态路由。
<br>
### **动态路由：**
动态路由选择：因特网，大型网络。
路由器的路由处理机 根据 路由选择协议 和其他路由器交互 自动更新配置 路由表。
<br>
为了源网络尽可能有效的到达目的网络，因特网采用分层次路由选择协议：
两个自治系统AS 之间通过 外部网关协议EGP连接，如BGP（边界网关协议）。
自治系统AS中使用内部网关协议IGP，如RIP（路由信息协议），OSPF(开放最短路径优先选择)。
^
#### **RIP路由信息协议**
用于小型互联网，以跳数作为网络距离，大于等于16跳时表示表示不可达。
周期性和相邻的路由器通过UDP报文进行交换路由表。
收敛：若干次交换和更新后，自治系统AS内每个路由器都知道到达目的路由器的最短距离和下一跳地址。
路由器C传来UDP的RIP报文(下一跳路由器地址，距离<16可达，16表示不可达) 更新自己路由器B的路由表。
RIP的缺点包括收敛速度慢、开销大、距离小、对大型网络支持不佳、对路由环路处理不足等。
#### **OSPF开放最短路径优先协议**
克服RIP缺点（开销大，距离小），使用了迪杰斯特拉最短路径算法SPF。OSPF开放最短路径优先协议在现代最流行。
基于洪泛IP报文根据链路状态。（度量代价权重：距离，带宽，费用）

#### **BGP边界网关协议**
不同自治系统的度量代价方式可能不同，为解决自治系统之间的最佳路由选择 和 因政治安全等原因的路由选择。
BGP路由选择：
选择并非最佳路由，而是适合策略的路由，BGP发言人TCP交换内部路由信息。
选择AS跳数最小。
选择热土豆路由算法(一种最短路径优先SPF）。
等。

# **ICMP**
网际控制报文协议ICMP：为了让 IP数据报 更有效转发和提高成功机会。
主机和路由器之间使用ICMP来发送**差错报告报文**和**询问报文**。
### **返回差错报告报文**：
终点不可达（不能交付），源点抑制（拥塞），时间超过（TTL=0），参数问题（首部出错），改变路由（重定向更好的路由）。
<br>
### **发送询问报文**：
1.回送的请求和回答：测试目的站是否可达，了解其有关状态。（ping命令）
2.时间戳的请求和回答：请求回答目的站当前的日期时间。
### **ping和tracert**：
ping命令：使用网际层（网络层）ICMP（回送请求和回答报文） 测试 主机和路由器之间的连通性。

tracert命令：Windows使用网际层ICMP（回送请求和回答报文、 返回差错报告报文的时间超过）测试IP数据报从源主机到达目的主机 经过哪些路由器。

traceroute命令：Unix使用运输层的UDP协议（返回差错报告报文的时间超过）测试IP数据报从源主机到达目的主机 经过哪些路由器。
<br> 

# **IGMP**
网际组管理协议IGMP：使多播路由器知道多播组成员信息。
配合多播路由选择协议，实现多播路由工作。