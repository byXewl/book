内网可能有几百台Windows，为了方便管理，常常把他们都加入了域同一管理，域控制器管理员电脑的账号密码可以登录所有Windows。
Active Directory (AD)域是最常见的Windows域服务。

08域控主机(开启域，DNS为自己)，win7普通主机(通过DNS加入域控)。
域控管理机上，创建的用户，可以登录域内的主机，并且可以给用户下发木马文件的策略。
域控管理机上，可以下发修改其他主机用户的密码，其他主机开放端口等。

使用域成员账户登录的域内主机，安装文件需要域控授权。除非切换成自己本地账户，才可以直接安装。

## **域的含义**
什么是Windows域？
  当企业网络中计算机和用户数量较多时，为了实现高效管理，就需要windows域。
一个通俗的例子：假设有一堆图书，没人管理，一个班的同学能够随意借阅这些书。由于缺乏管理，图书可能会遇到各种各样的问题，比如图书破损、丢失等等。为了解决这个问题，班上设立一个图书管理员，他负责分配、管理这些图书，任何想借书的人都需要向他申请。类比这个例子，一个集体拥有一些计算机资源，如果没有一个统一的管理系统，每个人都能随意操作这些计算机，就会使运维的成本变高，为了解决这个问题，我们也可以像管理图书一样设立一个管理员，由它来统一管理计算机。那么这套体系可以称为一个域，域控制器就充当了管理员的角色，任何加入域的计算机都需要服从管理员的管理。

  域既是 Windows 网络操作系统的逻辑组织单元，也是Internet的逻辑组织单元，在 Windows 网络操作系统中，域是安全边界。域管理员只能管理域的内部，除非其他的域显式地赋予他管理权限，他才能够访问或者管理其他的域，每个域都有自己的安全策略，以及它与其他域的安全信任关系。
域是Windows网络中独立运行的单位，域之间相互访问则需要建立信任关系。信任关系是连接在域与域之间的桥梁。当一个域与其他域建立了信任关系后，2个域之间不但可以按需要相互进行管理，还可以跨网分配文件和打印机等设备资源，使不同的域之间实现网络资源的共享与管理，以及相互通信和数据传输。


 


## **场景**
0x01
一个具有一定规模的企业，每天都可能面临员工入职和离职，因此网络管理部门经常需要
对域成员主机进行格式化消除磁盘的文件，然后重装系统及软件，以提供给新员工使用；
因此，为了便于后期交接，大多网络管理员会做好一个系统镜像盘，统一安装所有的电
脑，并且在安装的时候设置惯用、甚至统一的密码。

0x02
因此，域中的计算机本地管理员账号，极有可能能够登陆域中较多的计算机，本地管理员
的密码在服务器上后期修改的概率，远低于在个人办公电脑上的概率，而域用户权限是较
低的，是无法在域成员主机上安装软件的，这将会发生下面的一幕：
某个域用户需要使用 viso 软件进行绘图操作，于是联系网络管理员进行安装，网络管理
员采用域管理员身份登录了域成员主机，并帮助其安装了 viso 软件，于是这个有计算机
基础的员工，切换身份登录到了本地计算机的管理员，后执行 mimikatz，从内存当中抓
取了域管理员的密码，便成功的控制了整个域。
0x03
因此，域渗透的思路就是：通过域成员主机，定位出域控制器 IP 及域管理员账号，利用
域成员主机作为跳板，扩大渗透范围，利用域管理员可以登陆域中任何成员主机的特性，
定位出域管理员登陆过的主机 IP，设法从域成员主机内存中 dump 出域管理员密码，进
而拿下域控制器、渗透整个内网。



## **God.org域靶机**
<https://blog.mbigfish.com/index.php/archives/1804/>
先启动DC主机，再启动成员机才能正常自动加入域。
webserver成员机加一个NAT网卡，即可访问外网通讯。

![image-20240412142237629](http://cdn.33129999.xyz/mk_img/image-20240412142237629.png)



^
## **各种域**

域是一个有安全边界的计算机集合（安全边界意思是在两个域中，一个域中的用户无法访问另一个域中的资源）
![](https://img.kancloud.cn/fd/32/fd32e5b156cf615698c6f34b794f5c11_767x495.png)

### 单域

* 在一般的小公司里，建立一个域就可以满足所需
* 一般在一个域内需要建立至少两个域服务器，一个做为DC，一个是备份DC\
  ![](https://img.kancloud.cn/91/4a/914a5d72af8eafe71ea9993888c83a99_754x509.png)

### 父域/子域/域树/域林

域树指若干个域通过建立信任关系组成的集合\
![](https://img.kancloud.cn/0b/56/0b56cc5e071db6f151a58c3612084871_781x401.png)

## **域控制器和AD**
DC是一个域中类似管理服务器的计算机，负责每一台连入的电脑和用户的验证工作\
备份域控制器 （BDC）

AD
* 活动目录（Active Directory），是域环境中提供目录服务的组件，逻辑结构为组织单元域、域树、域森林。域树内的所有域共享一个活动目录，安装了AD的计算机就变成DC
* 目录就是存储有关网络对象（如用户、组、计算机、共享资源、打印机和联系人等）的信息，目录服务是帮助用户快速准确的从目录中查找到他所需要的信息的服务

DC和AD区别
* 如果网络规模较大，就要把网络中的众多对象，例如计算机、用户、用户组、打印机、共享文件等，分门别类、井然有序地放在一个大仓库中，并将检索信息整理好，以便查找、管理和使用这些对象（资源），这个拥有层次结构的数据库，就是活动目录数据库，简称AD库。
* 要实现域环境，其实就是要安装AD，如果内网中的一台计算机上安装了AD，它就变成了DC（用于存储活动目录数据库的计算机）

## **安全域的划分**

```
安全级别最高的LAN Area（内网）
        局域网，外网访问不到
安全级别中等的DMZ区域
        提供给外部用户访问的门站，例如web等
安全级别最低的Internet区域（外网）
        互联网
```

![](https://img.kancloud.cn/eb/3f/eb3f78c4abad179fd135496dfc8a4d46_823x439.png)

## []()访问控制策略

```
1、内网可以访问外网
2、内网可以访问DMZ
3、外网不能访问内网
4、外网可以访问DMZ
5、DMZ访问内网有限制
6、DMZ不能访问外网
```

## []()域权限划分

![](https://img.kancloud.cn/b4/f6/b4f63322b2ffe3c1cf89ea70d16b037c_752x650.png)


A. 全局组（Global Group）：全局组用于跨域的资源访问控制，其成员可以包含同一域中的用户、计算机和其他全局组。

B. 本地域组（Domain Local Group）：本地域组用于本地域的资源访问控制，其成员可以包含同一域中的用户、计算机、全局组和其他本地域组。

D. 通用组（Universal Group）：通用组用于跨域和本地域的资源访问控制，其成员可以包含同一域中的用户、计算机、全局组、本地域组和其他通用组。


## []()域内权限（A-G-DL-P）

* 域本地组（DL）：来自全林作用于本域
* 域全局组（G ）：来自本域作用于全林
* 域通用组（C ）：来自全林作用于全林



