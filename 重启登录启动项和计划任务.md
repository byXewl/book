## **服务和计划任务**

在Windows操作系统中，服务（Services）和计划任务（Scheduled Tasks）都是自动化执行特定任务的机制，但它们在设计目的、工作方式和使用场景上存在一些区别：

 Windows服务（Services）
1. **后台运行**：服务在系统后台运行，通常没有交互式用户界面（GUI），即使在没有用户登录的情况下也能运行。
2. **自动启动**：服务可以在系统启动时自动运行，或者手动启动，并在需要时持续运行。
3. **系统权限**：服务可以以系统权限运行，这意味着它们可以访问系统资源和执行需要高权限的操作。
4. **依赖性**：服务之间可以设置依赖关系，确保某些服务在其他服务启动后运行。
5. **可管理性**：服务可以通过服务管理控制台（services.msc）或命令行工具（如sc和net命令）进行管理。
6. **稳定性和性能**：服务设计用于长期稳定运行，适合需要持续运行或频繁执行的任务。

 计划任务（Scheduled Tasks）
1. **定时执行**：计划任务根据预定的时间表执行，可以设置一次性任务或周期性任务。
2. **用户交互**：计划任务可以在特定用户登录后运行，并且可以与用户交互，例如打开GUI应用程序。
3. **启动方式**：计划任务在触发时启动，执行完毕后通常会退出。
4. **权限问题**：计划任务通常以创建它们的用户权限运行，除非特别指定。
5. **灵活性**：计划任务提供了更多的灵活性，可以设置复杂的触发条件，如特定时间、系统空闲、用户登录等。
6. **任务类型**：计划任务可以执行程序、发送电子邮件、显示消息等多种类型的任务。
7. **管理工具**：计划任务可以通过任务计划程序（Task Scheduler）或命令行工具（如at 、schtasks）进行管理。

 区别
* **运行方式**：服务持续运行，而计划任务按计划执行。
* **用户界面**：服务通常没有用户界面，计划任务可以启动带有用户界面的程序。
* **权限**：服务通常以系统权限运行，而计划任务以创建它们的用户权限运行。
* **触发条件**：服务依赖于启动类型和系统事件，计划任务依赖于时间表或其他触发条件。

^
## **重启登录自动上线**
Windows重启时，触发后门上线。
方式：自启动项目录，服务加载，注册表增加启动项。
查看启动项列表：有自启动目录里的程序，还有注册表添加的启动项程序

#### **利用自启动项目录 重启上线**
将木马文件放置在系统的自启动目录下
这里要注意，通常我们所使用的系统都是中文版的，有些系统可能被调整过所以在目录中显示的都是英文，而有些会出现是中文的情况，下面的这台虚拟机就是这样的。
```
C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\   
 ##英文
C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\开始菜单\程序\启动\   
 ##中文
```
对主机重启后发现，主机自动运行后门程序上线。

#### **利用服务加载 重启上线**
借助服务程序实现自动上线，比如创建一个服务，将服务指向木马，并将启动类型调整为自动，那么下次开机的时候，就会自动执行木马。
```
sc create Muma binPath= C:\1\3000.exe start= auto    #创建自启动服务 路径执行木马
sc delete Muma   #删除该服务
```
重启主机就会让系统加载服务，刚创建的服务是无法直接运行也可以手动运行。

#### **利用注册表增加启动项 重启上线**
注册表加载就是将木马添加到注册表中，新增启动项，让指定的程序在电脑重启登录后进行加载。

不同权限的注册表路径是不同的，有当前用户的，也有直接是服务器的，
当前用户的基本上你获取到用户权限就可以添加了，而且服务器也就是system权限，这个是需要提权的。

win+r：regedit 
当前用户键值注册表路径:
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
服务器键值注册表路径（需要管理员权限）:
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run 


添加后门注册表值
```
REG ADD "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" /V "backdoor" /t REG_SZ /F /D "C:\1\3000.exe"

"HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"：
HKCU 是 HKEY_CURRENT_USER 的缩写，表示当前用户的注册表视图。
这个路径是 Windows 启动时用来确定哪些程序需要自动运行的注册表键。
```
查看注册表值win+r：regedit 
重启主机，重启登录后可以看到成功上线了。


^
## **计划任务上线维持**
Windows的计划任务：
在Windows系统<2012的时候可以使用at命令，同时at命令默认是以system权限执行。
从Windows server 2012之后就不可以使用at命令了，而改成schtasks来进行添加计划任务，


创建计划任务
```
创建一个名为TestService的计划任务，并在每天的9.46分运行C盘下1目录中的3000.exe程序。

创建任务：schtasks /Create /TN TestService /SC DAILY /ST 09:46 /TR c:\1\3000.exe /RL HIGHEST  
查看任务：SchTasks /Query /TN TestService
删除任务：SchTasks /Delete /TN TestService [/f]
```
这里只要到时间了，计划任务就会运行，当运行后程序就会上线。